/*! Built with http://stenciljs.com */
const{h:t}=window.App;import{a as i,b as e,c as o}from"./chunk-f40e6196.js";import{a as s}from"./chunk-07f3c6db.js";import{a as n}from"./chunk-3276dfdd.js";import{a}from"./chunk-4748410c.js";class r{constructor(){this.recordID="",this.view="",this.todoItem=new n,this.doneItem=new a,this.formItem=new s,this.passAction="pass",this.backAction="back",this.todoAction="todo",this.doneAction="done"}componentDidLoad(){const t=this.history.location.query;if(t)switch(this.recordID=t.record_id,this.view=t.view,this.view){case this.todoAction:this.fetchTodo();break;case this.doneAction:this.fetchDone()}}async fetchTodo(){const t=await i.loading();e(`/api/v1/flows/todo/${this.recordID}`).then(i=>{this.todoItem=i,this.formItem=JSON.parse(i.input_data),this.formItem.audit_comment="",t.dismiss()}).catch(()=>{t.dismiss(),i.alert("服务器发生错误")})}async fetchDone(){const t=await i.loading();e(`/api/v1/flows/done/${this.recordID}`).then(i=>{this.doneItem=i,this.formItem=JSON.parse(i.out_data),t.dismiss()}).catch(()=>{t.dismiss(),i.alert("服务器发生错误")})}async submit(){const t=await i.loading("正在提交..."),e=JSON.stringify(this.formItem);o("/api/v1/flows/handle",{record_id:this.recordID,form_data:e}).then(e=>{t.dismiss(),"ok"===e&&i.alert("提交成功","",()=>{this.history.replace("/")})}).catch(()=>{t.dismiss(),i.alert("服务器发生错误")})}handleSubmit(t){if(this.view!==this.todoAction)return;let e="确定提交通过吗？";"back"===t&&(e="确定提交不通过吗？"),i.confirm(e,"提醒",()=>{this.formItem.action=t,this.submit()})}handleInputChange(t,i){switch(t){case"audit_comment":this.formItem.audit_comment=i.target.value}}renderAuditAction(){if(this.view===this.doneAction)switch(this.formItem.action){case this.passAction:return t("ion-item",null,t("ion-label",{color:"success",style:{"text-align":"center"}},"审批通过"));case this.backAction:return t("ion-item",null,t("ion-label",{color:"danger",style:{"text-align":"center"}},"审批不通过"))}}renderSubmit(){if(this.view===this.todoAction)return t("div",null,t("ion-button",{expand:"block",class:"form-submit",color:"success",onClick:()=>this.handleSubmit(this.passAction)},"通 过"),t("ion-button",{expand:"block",class:"form-submit",color:"warning",onClick:()=>this.handleSubmit(this.backAction)},"不通过"))}render(){return t("form",{class:"form"},t("ion-list",{lines:"none"},t("ion-title",null,"通用申请"),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请标题"),t("ion-input",{readonly:!0,clearInput:!1,clearOnEdit:!1,spellcheck:!1,type:"text",value:this.formItem.title})),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请内容"),t("ion-textarea",{readonly:!0,value:this.formItem.content})),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请日期"),t("ion-input",{readonly:!0,clearInput:!1,clearOnEdit:!1,spellcheck:!1,type:"text",value:this.formItem.apply_date})),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked"},"审批意见"),t("ion-textarea",{readonly:this.view!==this.todoAction,value:this.formItem.audit_comment,onIonChange:t=>{this.handleInputChange("audit_comment",t)}})),this.renderAuditAction(),this.renderSubmit()))}static get is(){return"app-apply-audit"}static get properties(){return{doneItem:{state:!0},formItem:{state:!0},history:{type:"Any",attr:"history"},recordID:{state:!0},todoItem:{state:!0},view:{state:!0}}}static get style(){return".form{padding:5px}.form-submit{margin-top:10px}.item-input-has-focus.item-input-has-value .input-clear-icon{display:none!important}.list-md .item-input.item-input-has-focus:last-child{-webkit-box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff));box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff))}"}}export{r as AppApplyAudit};