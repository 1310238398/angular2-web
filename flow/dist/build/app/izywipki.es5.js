/*! Built with http://stenciljs.com */
var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};App.loadBundle("izywipki",["exports","./chunk-666d0cc3.js","./chunk-e6612fa2.js","./chunk-13604b3c.js","./chunk-dcb18ea7.js"],function(t,e,n,i,o){var r=window.App.h,s=function(){function t(){this.recordID="",this.view="",this.todoItem=new i.TodoItem,this.doneItem=new o.DoneItem,this.formItem=new n.ApplyItem,this.passAction="pass",this.backAction="back",this.todoAction="todo",this.doneAction="done"}return t.prototype.componentDidLoad=function(){var t=this.history.location.query;if(t)switch(this.recordID=t.record_id,this.view=t.view,this.view){case this.todoAction:this.fetchTodo();break;case this.doneAction:this.fetchDone()}},t.prototype.fetchTodo=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(i){switch(i.label){case 0:return[4,e.util.loading()];case 1:return t=i.sent(),e.fetchFlowGet("/api/v1/flows/todo/"+this.recordID).then(function(e){n.todoItem=e,n.formItem=JSON.parse(e.input_data),n.formItem.audit_comment="",t.dismiss()}).catch(function(){t.dismiss(),e.util.alert("服务器发生错误")}),[2]}})})},t.prototype.fetchDone=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(i){switch(i.label){case 0:return[4,e.util.loading()];case 1:return t=i.sent(),e.fetchFlowGet("/api/v1/flows/done/"+this.recordID).then(function(e){n.doneItem=e,n.formItem=JSON.parse(e.out_data),t.dismiss()}).catch(function(){t.dismiss(),e.util.alert("服务器发生错误")}),[2]}})})},t.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,e.util.loading("正在提交...")];case 1:return t=o.sent(),n=JSON.stringify(this.formItem),e.fetchFlowPost("/api/v1/flows/handle",{record_id:this.recordID,form_data:n}).then(function(n){t.dismiss(),"ok"===n&&e.util.alert("提交成功","",function(){i.history.replace("/")})}).catch(function(){t.dismiss(),e.util.alert("服务器发生错误")}),[2]}})})},t.prototype.handleSubmit=function(t){var n=this;if(this.view===this.todoAction){var i="确定提交通过吗？";"back"===t&&(i="确定提交不通过吗？"),e.util.confirm(i,"提醒",function(){n.formItem.action=t,n.submit()})}},t.prototype.handleInputChange=function(t,e){switch(t){case"audit_comment":this.formItem.audit_comment=e.target.value}},t.prototype.renderAuditAction=function(){if(this.view===this.doneAction)switch(this.formItem.action){case this.passAction:return r("ion-item",null,r("ion-label",{color:"success",style:{"text-align":"center"}},"审批通过"));case this.backAction:return r("ion-item",null,r("ion-label",{color:"danger",style:{"text-align":"center"}},"审批不通过"))}},t.prototype.renderSubmit=function(){var t=this;if(this.view===this.todoAction)return r("div",null,r("ion-button",{expand:"block",class:"form-submit",color:"success",onClick:function(){return t.handleSubmit(t.passAction)}},"通 过"),r("ion-button",{expand:"block",class:"form-submit",color:"warning",onClick:function(){return t.handleSubmit(t.backAction)}},"不通过"))},t.prototype.render=function(){var t=this;return r("form",{class:"form"},r("ion-list",{lines:"none"},r("ion-title",null,"通用申请"),r("ion-item",{lines:"inset"},r("ion-label",{position:"stacked",class:"form-item-required"},"申请标题"),r("ion-input",{readonly:!0,clearInput:!1,clearOnEdit:!1,spellcheck:!1,type:"text",value:this.formItem.title})),r("ion-item",{lines:"inset"},r("ion-label",{position:"stacked",class:"form-item-required"},"申请内容"),r("ion-textarea",{readonly:!0,value:this.formItem.content})),r("ion-item",{lines:"inset"},r("ion-label",{position:"stacked",class:"form-item-required"},"申请日期"),r("ion-input",{readonly:!0,clearInput:!1,clearOnEdit:!1,spellcheck:!1,type:"text",value:this.formItem.apply_date})),r("ion-item",{lines:"inset"},r("ion-label",{position:"stacked"},"审批意见"),r("ion-textarea",{readonly:this.view!==this.todoAction,value:this.formItem.audit_comment,onIonChange:function(e){t.handleInputChange("audit_comment",e)}})),this.renderAuditAction(),this.renderSubmit()))},Object.defineProperty(t,"is",{get:function(){return"app-apply-audit"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{doneItem:{state:!0},formItem:{state:!0},history:{type:"Any",attr:"history"},recordID:{state:!0},todoItem:{state:!0},view:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return".form{padding:5px}.form-submit{margin-top:10px}.item-input-has-focus.item-input-has-value .input-clear-icon{display:none!important}.list-md .item-input.item-input-has-focus:last-child{-webkit-box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff));box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff))}"},enumerable:!0,configurable:!0}),t}();t.AppApplyAudit=s,Object.defineProperty(t,"__esModule",{value:!0})});