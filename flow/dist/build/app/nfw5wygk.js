/*! Built with http://stenciljs.com */
const{h:t}=window.App;import{a as e,b as i,c as s}from"./chunk-f40e6196.js";import{a as n}from"./chunk-07f3c6db.js";import{a as o}from"./chunk-4748410c.js";class a{constructor(){this.flowID="",this.recordID="",this.view="",this.doneItem=new o,this.formItem=new n,this.createAction="create",this.doneAction="done"}componentDidLoad(){const t=this.history.location.query;if(t)switch(this.view=t.view,this.view){case this.createAction:this.flowID=t.flow_id;break;case this.doneAction:this.recordID=t.record_id,this.fetchDone()}}async fetchDone(){const t=await e.loading();i(`/api/v1/flows/done/${this.recordID}`).then(e=>{this.doneItem=e,this.formItem=JSON.parse(e.out_data),t.dismiss()}).catch(()=>{t.dismiss(),e.alert("服务器发生错误")})}async handleSubmit(t){this.view===this.createAction&&(t.preventDefault(),""!==this.formItem.title?""!==this.formItem.content?e.confirm("确定提交吗？","提醒",async()=>{const t=await e.loading("正在提交...");delete this.formItem.action,delete this.formItem.audit_comment;const i=JSON.stringify(this.formItem);s("/api/v1/flows/launch",{flow_id:this.flowID,form_data:i}).then(i=>{t.dismiss(),"ok"===i&&e.alert("提交成功","",()=>{this.history.replace("/")})}).catch(()=>{t.dismiss(),e.alert("服务器发生错误")})}):e.alert("请输入申请内容"):e.alert("请输入申请标题"))}handleInputChange(t,e){switch(t){case"title":this.formItem.title=e.target.value;break;case"content":this.formItem.content=e.target.value;break;case"apply_date":this.formItem.apply_date=e.target.textContent}}renderSubmit(){if(this.view===this.createAction)return t("ion-button",{type:"submit",expand:"block",class:"form-submit"},"提 交")}render(){return t("form",{class:"form",onSubmit:t=>this.handleSubmit(t)},t("ion-list",null,t("ion-title",null,"通用申请"),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请标题"),t("ion-input",{readonly:this.view===this.doneAction,name:"title",type:"text",value:this.formItem.title,placeholder:"请输入标题",onIonChange:t=>{this.handleInputChange("title",t)}})),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请内容"),t("ion-textarea",{readonly:this.view===this.doneAction,value:this.formItem.content,placeholder:"请输入内容",onIonChange:t=>{this.handleInputChange("content",t)}})),t("ion-item",{lines:"inset"},t("ion-label",{position:"stacked",class:"form-item-required"},"申请日期"),t("ion-datetime",{disabled:this.view===this.doneAction,cancelText:"取消",doneText:"完成",displayFormat:"YYYY-MM-DD",min:"2010",max:"2020",value:this.formItem.apply_date,style:{"margin-left":"10px"},onIonStyle:t=>{this.handleInputChange("apply_date",t)}})),this.renderSubmit()))}static get is(){return"app-apply-launch"}static get properties(){return{doneItem:{state:!0},flowID:{state:!0},formItem:{state:!0},history:{type:"Any",attr:"history"},recordID:{state:!0},view:{state:!0}}}static get style(){return".form{padding:5px}.form-submit{margin-top:10px}.item-input-has-focus.item-input-has-value .input-clear-icon{display:none!important}.list-md .item-input.item-input-has-focus:last-child{-webkit-box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff));box-shadow:inset 0 0 0 0 var(--ion-color-md-primary,var(--ion-color-primary,#3880ff))}"}}export{a as AppApplyLaunch};