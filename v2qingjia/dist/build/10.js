webpackJsonp([10],{248:function(n,t,l){"use strict";function e(n){return a._22(0,[(n()(),a.Z(0,0,null,null,3,"div",[["class","waring"]],null,null,null,null,null)),(n()(),a.Z(1,0,null,null,1,"ion-icon",[["class","font"],["name","ios-alert-outline"],["role","img"]],[[2,"hide",null]],null,null,null,null)),a.Y(2,147456,null,0,I.a,[k.a,a.j,a.z],{name:[0,"name"]},null),(n()(),a._20(-1,null,["定位未在学校范围内，请重新定位（请点击地图右下角图标）\n    或上传照片证明本人已到校"]))],function(n,t){n(t,2,0,"ios-alert-outline")},function(n,t){n(t,1,0,a._13(t,2)._hidden)})}function o(n){return a._22(0,[(n()(),a.Z(0,0,null,null,1,"span",[["class","info zhengming"]],null,null,null,null,null)),(n()(),a._20(-1,null,["最多可以上传三张，每张照片不大于5M"]))],null,null)}function i(n){return a._22(0,[(n()(),a.Z(0,0,null,null,6,"div",[["class","Certify"]],null,null,null,null,null)),(n()(),a._20(-1,null,["\n  "])),(n()(),a.Z(2,0,null,null,1,"ion-icon",[["class","delete"],["ios","ios-close-outline"],["md","md-close"],["role","img"]],[[2,"hide",null]],[[null,"click"]],function(n,t,l){var e=!0;if("click"===t){e=!1!==n.component.deleteCertify(l,n.context.index)&&e}return e},null,null)),a.Y(3,147456,null,0,I.a,[k.a,a.j,a.z],{ios:[0,"ios"],md:[1,"md"]},null),(n()(),a._20(-1,null,["\n  "])),(n()(),a.Z(5,0,null,null,0,"img",[],[[8,"src",4]],[[null,"click"]],function(n,t,l){var e=!0,o=n.component;if("click"===t){e=!1!==o.navPreview({time:!1,index:n.context.index,items:o.CertifyImgs})&&e}return e},null,null)),(n()(),a._20(-1,null,["\n"]))],function(n,t){n(t,3,0,"ios-close-outline","md-close")},function(n,t){var l=t.component;n(t,2,0,a._13(t,3)._hidden);n(t,5,0,l.DomSanitization.bypassSecurityTrustUrl(t.context.$implicit.url))})}function u(n){return a._22(0,[a._18(402653184,1,{mapElement:0}),(n()(),a.Z(1,0,null,null,31,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,F.b,F.a)),a.Y(2,4374528,null,0,w.a,[k.a,S.a,U.a,a.j,a.z,M.a,R.a,a.u,[2,L.a],[2,D.a]],null,null),(n()(),a._20(-1,1,["\n  "])),(n()(),a.Z(4,0,[[1,0],["containerMap",1]],1,0,"div",[["id","containerMap"],["style","width: 100%; height: 225px"]],null,null,null,null,null)),(n()(),a._20(-1,1,["\n  "])),(n()(),a.U(16777216,null,1,1,null,e)),a.Y(7,16384,null,0,z.i,[a.I,a.F],{ngIf:[0,"ngIf"]},null),(n()(),a._20(-1,1,["\n"])),(n()(),a._20(-1,1,["\n"])),(n()(),a.Z(10,0,null,1,14,"div",[["class","upload"]],null,null,null,null,null)),(n()(),a._20(-1,null,["\n  "])),(n()(),a.Z(12,0,null,null,1,"div",[["class","zhengming"]],null,null,null,null,null)),(n()(),a._20(-1,null,["（可选）请上传照片：（部分请假材料或到校证明照片）"])),(n()(),a._20(-1,null,["\n    "])),(n()(),a.Z(15,0,null,null,0,"img",[["id","pickfilesImg"],["src","assets/images/add.png"]],null,null,null,null,null)),(n()(),a._20(-1,null,["\n  "])),(n()(),a.U(16777216,null,null,1,null,o)),a.Y(18,16384,null,0,z.i,[a.I,a.F],{ngIf:[0,"ngIf"]},null),(n()(),a._20(-1,null,["\n"])),(n()(),a.U(16777216,null,null,1,null,i)),a.Y(21,802816,null,0,z.h,[a.I,a.F,a.p],{ngForOf:[0,"ngForOf"]},null),(n()(),a._20(-1,null,["\n"])),(n()(),a.Z(23,0,null,null,0,"div",[["class","clear"]],null,null,null,null,null)),(n()(),a._20(-1,null,["\n"])),(n()(),a._20(-1,1,["\n  "])),(n()(),a.Z(26,0,null,1,5,"div",[["padding",""]],null,null,null,null,null)),(n()(),a._20(-1,null,["\n    "])),(n()(),a.Z(28,0,null,null,2,"button",[["block",""],["color","zj-main-color"],["ion-button",""]],null,[[null,"click"]],function(n,t,l){var e=!0;if("click"===t){e=!1!==n.component.onConfirmSubmit()&&e}return e},O.b,O.a)),a.Y(29,1097728,null,0,j.a,[[8,""],k.a,a.j,a.z],{color:[0,"color"],block:[1,"block"]},null),(n()(),a._20(-1,0,["确认位置并提交申请"])),(n()(),a._20(-1,null,["\n  "])),(n()(),a._20(-1,1,["\n"])),(n()(),a._20(-1,null,["\n"]))],function(n,t){var l=t.component;n(t,7,0,l.isWaring);n(t,18,0,!l.CertifyImgs.length);n(t,21,0,l.CertifyImgs);n(t,29,0,"zj-main-color","")},function(n,t){n(t,1,0,a._13(t,2).statusbarPadding,a._13(t,2)._hasRefresher)})}Object.defineProperty(t,"__esModule",{value:!0});var a=l(0),s=(l(7),l(70),l(50)),r=l(51),c=l(258),p=l(110),d=l(31),h=function(){function n(n,t,l,e,o,i,u){var a=this;this.loadingCtrl=n,this.DomSanitization=t,this.navCtrl=l,this.http=e,this.params=o,this.HelpUtils=i,this.isDisabled=!0,this.applyDate=(new Date).toISOString(),this.Certify={AttachmentKey:"",AttachmentCode:""},this.arriveSchool=!1,this.isWaring=!1,this.SchoolPath=[117.131944,36.673466],this.CertifyImgs=[],this.currentPosition=[],this.UserInfo={Name:"",UserCode:"",AcademyName:"",ClassName:"",applyDate:""},u.getSchoolLocation().then(function(n){a.SchoolPath=n.Data.LocationCenter.split(","),a.SchoolRadius=n.Data.LocationRadius}),this.leaveApply=this.params.get("leaveApply"),console.log(this.leaveApply)}return n.prototype.ionViewWillEnter=function(){antlinker.configTitle({type:"label",title:"销假申请",fail:function(){},success:""}),antlinker.configTitleButton({showClose:!0,type:"empty",success:"",fail:function(){}})},n.prototype.initQiniu=function(){var n=this;this.uploader=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfilesImg",domain:"http://qiniu-plupload.qiniudn.com/",uptoken_func:function(t){console.log("uptoken_func"+t.size);var l="";t.getNative();return n.http.postXhr({Router:p.a.Url.getUpToken,Method:"POST",Body:{Name:t.name,Size:t.size,BizType:"LeaveApplication"}},function(t){t.Data&&t.Data.Proof&&(n.Certify.AttachmentKey=t.Data.Key||"",n.Certify.AttachmentCode=t.Data.AttachmentCode||"",l=""+t.Data.Proof)}),console.log(l),l},filters:{max_file_size:"5mb",prevent_duplicates:!1,mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]},save_key:!1,disable_statistics_report:!0,unique_names:!1,get_new_uptoken:!0,max_file_size:"5mb",max_retries:4,log_level:5,flash_swf_url:"assets/lib/Moxie.swf",multi_selection:!1,dragdrop:!1,chunk_size:"4mb",auto_start:!0,init:{Key:function(t,l){return console.log("Key"+l.size),n.Certify.AttachmentKey||""},FilesAdded:function(t,l){console.log("FilesAdded"+l[0].getNative().size),n.CertifyImgs.length>=3?(t.removeFile(l[0]),n.HelpUtils.alert("证明材料最多可选择三张")):(n.fileLoading=n.loadingCtrl.create({content:"正在上传，请稍等..."}),n.fileLoading.present())},BeforeUpload:function(n,t){console.log("BeforeUpload"+t.size)},UploadProgress:function(n,t){},FileUploaded:function(t,l,e){console.log(moment(l.lastModifiedDate).format("YYYY-MM-DD HH:mm"));var o=Object.assign({url:window.URL.createObjectURL(l.getNative()),AttachmentTime:moment(l.getNative().lastModifiedDate).format("YYYY-MM-DD HH:mm")},n.Certify);n.CertifyImgs.push(o)},UploadComplete:function(){n.fileLoading.dismiss()},Error:function(t,l,e){switch(t.removeFile(l.file),l.code){case-600:n.HelpUtils.toastPop("上传文件超出大小限制！");break;case-601:n.HelpUtils.toastPop("文件扩展名不正确！");break;case 401:n.HelpUtils.toastPop("认证授权失败！");break;case 404:n.HelpUtils.toastPop("资源不存在！");break;default:n.HelpUtils.toastPop(l.status+":"+l.response)}}}})},n.prototype.startUpload=function(){},n.prototype.ionViewDidLoad=function(){var n,t=this;console.log(AMap),this.map=new AMap.Map(this.mapElement.nativeElement,{resizeEnable:!0}),this.map.plugin("AMap.Geolocation",function(){n=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,showButton:!0,buttonPosition:"RB",buttonOffset:new AMap.Pixel(10,20),showMarker:!0,showCircle:!0,panToLocation:!0,zoomToAccuracy:!0}),t.map.addControl(n),n.getCurrentPosition(),AMap.event.addListener(n,"complete",function(n){t.currentPosition=[],t.currentPosition.push(n.position.getLng()),t.currentPosition.push(n.position.getLat()),console.log(t.currentPosition),t.isDisabled=!1;var l=["定位成功"];l.push("经度："+n.position.getLng()),l.push("纬度："+n.position.getLat()),l.push("精度："+n.accuracy+" 米"),l.push("是否经过偏移："+(n.isConverted?"是":"否")),console.log(l.join("<br>")),t.circle=new AMap.Circle({map:t.map,center:t.SchoolPath,radius:t.SchoolRadius,strokeColor:"#67BFFD",strokeOpacity:1,strokeWeight:3,fillColor:"#67BFFD",fillOpacity:.35}),t.circle.contains(t.currentPosition)&&t.map.setFitView()}),AMap.event.addListener(n,"error",function(n){t.isWaring=!0})}),this.initQiniu()},n.prototype.onConfirmSubmit=function(){if(console.log(this.leaveApply),this.isWaring=!1,console.log(this.currentPosition),2==this.currentPosition.length)if(this.circle.contains(this.currentPosition))this.applyXiaojia({RecordId:this.leaveApply.RecordId||"",FlowRecordId:this.leaveApply.FlowRecordId||"",Location:this.currentPosition.join(),Attachs:this.CertifyImgs||[]});else{if(!this.CertifyImgs.length)return void(this.isWaring=!0);this.applyXiaojia({RecordId:this.leaveApply.RecordId||"",FlowRecordId:this.leaveApply.FlowRecordId||"",Location:"",Attachs:this.CertifyImgs||[]})}else{if(this.isWaring=!0,!this.CertifyImgs.length)return void this.HelpUtils.toastPop("尚未定位到学校范围，请上传证明材料！");this.applyXiaojia({RecordId:this.leaveApply.RecordId||"",FlowRecordId:this.leaveApply.FlowRecordId||"",Location:"",Attachs:this.CertifyImgs||[]})}},n.prototype.applyXiaojia=function(n){var t=this;this.http.postJSON({Router:p.a.Url.recallapply,Method:"POST",Body:n}).then(function(n){n.FeedbackCode||(t.HelpUtils.toastPop("销假申请已提交，已放入销假列表中！"),t.navCtrl.push("ListPage"))})},n.prototype.deleteCertify=function(n,t){console.log(n),this.CertifyImgs.splice(t,1),n.stopPropagation()},n.prototype.navPreview=function(n){this.navCtrl.push("PreviewPage",n)},n}(),f=function(){return function(){}}(),g=l(187),m=l(188),y=l(189),_=l(190),v=l(191),C=l(192),b=l(193),P=l(194),A=l(195),I=l(39),k=l(1),F=l(257),w=l(21),S=l(3),U=l(9),M=l(8),R=l(34),L=l(4),D=l(20),z=l(13),O=l(38),j=l(19),x=l(80),Z=l(10),Y=a.X({encapsulation:2,styles:[],data:{}}),B=a.V("page-resume-leave-address",h,function(n){return a._22(0,[(n()(),a.Z(0,0,null,null,1,"page-resume-leave-address",[],null,null,null,u,Y)),a.Y(1,49152,null,0,h,[x.a,d.c,D.a,s.a,Z.a,r.a,c.a],null,null)],null,null)},{},{},[]),N=l(16),T=l(111),H=l(35);l.d(t,"ResumeLeaveAddressPageModuleNgFactory",function(){return W});var W=a.W(f,[],function(n){return a._10([a._11(512,a.i,a.S,[[8,[g.a,m.a,y.a,_.a,v.a,C.a,b.a,P.a,A.a,B]],[3,a.i],a.s]),a._11(4608,z.k,z.j,[a.r,[2,z.t]]),a._11(4608,N.t,N.t,[]),a._11(4608,N.d,N.d,[]),a._11(4608,c.a,c.a,[s.a]),a._11(512,z.b,z.b,[]),a._11(512,N.q,N.q,[]),a._11(512,N.g,N.g,[]),a._11(512,N.o,N.o,[]),a._11(512,T.a,T.a,[]),a._11(512,T.b,T.b,[]),a._11(512,f,f,[]),a._11(256,H.a,h,[])])})},257:function(n,t,l){"use strict";function e(n){return o._22(2,[o._18(402653184,1,{_fixedContent:0}),o._18(402653184,2,{_scrollContent:0}),(n()(),o.Z(2,0,[[1,0],["fixedContent",1]],null,1,"div",[["class","fixed-content"]],null,null,null,null,null)),o._12(null,0),(n()(),o.Z(4,0,[[2,0],["scrollContent",1]],null,1,"div",[["class","scroll-content"]],null,null,null,null,null)),o._12(null,1),o._12(null,2)],null,null)}l.d(t,"a",function(){return i}),t.b=e;var o=l(0),i=(l(21),l(1),l(3),l(9),l(34),l(4),l(20),o.X({encapsulation:2,styles:[],data:{}}))},258:function(n,t,l){"use strict";l.d(t,"a",function(){return o});l(7),l(50);var e=l(110),o=function(){function n(n){this.http=n,this.pushFlag=!1}return n.prototype.getPushFlag=function(){return this.pushFlag},n.prototype.setPushFlag=function(){this.pushFlag=!0},n.prototype.getUserInfo=function(){this.http.postJSON({Router:e.a.Url.queryleavestudentmessage,Method:"POST",Body:{}}).then(function(n){if(!n.FeedbackCode)return n})},n.prototype.getStudentApplyLocationAndAuthReason=function(n){return this.http.postJSON({Router:e.a.Url.queryapplyrefuse,Method:"POST",Body:n}).then(function(n){if(!n.FeedbackCode)return n})},n.prototype.getSchoolLocation=function(){return this.http.postJSON({Router:e.a.Url.QueryCampusLocation,Method:"POST",Body:{}}).then(function(n){if(!n.FeedbackCode)return n})},n.prototype.getStudentLeaveApply=function(n){return this.http.postJSON({Router:e.a.Url.querystudentleaveapplication,Method:"POST",Body:n}).then(function(n){if(!n.FeedbackCode)return n})},n.prototype.getFlow=function(n){return this.http.postJSON({Router:e.a.Url.getFlow,Method:"POST",Body:n}).then(function(n){if(!n.FeedbackCode)return n})},n}()}});